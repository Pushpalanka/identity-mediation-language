@Path ("/travelocity")
@Source (protocol="http", host="localhost", port="8290")
package org.wso2.travelocity;

//constant travelocityInboundEP = new URL("http://localhost:8290/travelocity")

@POST
@Path ("/saml")
resource saml (message m) {
	// Mediator/Handler chain
	SAMLRequestProcessor(m);
	AuthenticationRequestBuilder(m, "authep=http://localhost:8290/authenticate/,callbackURL=http://localhost:8290/travelocity/localauth")

}

@POST
@Path ("/localauth")
resource localauth (message m) {

	// process localauth response
	AuthenticationResponseProcessor(m, "isSubject=true,subjectClaim=username,isAttribute=true")	

	// send OIDC requst to federated IDP
	OIDCRequestBuilder("scope=openid email profile,tokenep=https://accounts.google.com/o/oauth2/v2/auth,callbackurl=http://ibus.wso2.com:8290/travelocity/oidc,clientid= MzAxMDY1MjUwMTM0LXRsdXE0cHBkYTEyNGxscHMyN3F1bTlsc203dXZqNG5wLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29t")

}

@POST
@GET
@Path ("/oidc")
resource oidc (message m) {
	// process the OIDC response
	OIDCResponseProcessor(m, "isSubject=true,subjectClaim=email,isAttribute=true")

	// send the saml response
	SAMLResponseBuilder(m)
} 
